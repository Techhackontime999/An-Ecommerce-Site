#!/bin/bash
echo "<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<Welcome To Shop-Seed>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>"
# Update the package list and upgrade all packages
echo "********************************************************************************************************************"
echo "Updating package list and upgrading packages..."
echo "********************************************************************************************************************"
sudo apt update && sudo apt upgrade -y
# Install necessary software packages
echo "********************************************************************************************************************"
echo "Installing necessary software packages..."
echo "********************************************************************************************************************"
SOFTWARE_LIST=(
    "graphviz graphviz-dev pkg-config libgraphviz-dev libjpeg-dev zlib1g-dev"
    "git"
    "build-essential"
    "gcc"
    "python3"
    "python3-pip"
)

for SOFTWARE in "${SOFTWARE_LIST[@]}"; do
    echo "Installing $SOFTWARE..."
    sudo apt install -y $SOFTWARE
done

# Clean up unnecessary packages
echo "********************************************************************************************************************"
echo "Cleaning up unnecessary packages..."
echo "********************************************************************************************************************"
sudo apt autoremove -y

# Verify installation
echo "********************************************************************************************************************"
echo "Verifying installed software..."
echo "********************************************************************************************************************"
for SOFTWARE in "${SOFTWARE_LIST[@]}"; do
    if command -v $SOFTWARE &>/dev/null; then
        echo "$SOFTWARE is installed successfully."
    else
        echo "Error: $SOFTWARE installation failed."
    fi
done
echo "********************************************************************************************************************"
echo "creating siteenv"
echo "********************************************************************************************************************"
python3 -m venv siteenv
echo "********************************************************************************************************************"
echo "activating siteenv"
echo "********************************************************************************************************************"
source "siteenv/bin/activate"
echo "********************************************************************************************************************"
echo "Now you are in siteenv"
echo "********************************************************************************************************************"
cd "An-Ecommerce-Site"
echo "********************************************************************************************************************"
echo "Installing software dependencies"
echo "********************************************************************************************************************"
pip install -r "requirements.txt"
echo "********************************************************************************************************************"
echo "Applying database migrations"
echo "********************************************************************************************************************"
python manage.py "makemigrations"
python manage.py "migrate"
echo "********************************************************************************************************************"
echo "creating default groups in software"
echo "********************************************************************************************************************"
python manage.py "create_default_groups"
echo "********************************************************************************************************************"
echo "creating now superuser enter below details"
echo "********************************************************************************************************************"
python manage.py "createsuperuser"
echo "********************************************************************************************************************"
echo "Software installation completed!"
echo "********************************************************************************************************************"
echo "Now starting server..."
echo "********************************************************************************************************************"
python manage.py runserver


